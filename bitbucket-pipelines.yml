# This is an example Starter pipeline configuration
# Use a skeleton to build, test and deploy using manual and parallel steps
# -----
# You can specify a custom docker image from Docker Hub as your build environment.
image: atlassian/default-image:2

pipelines:
  tags:
    release-*:
     - step:
        script:
         
         #- git pull origin $BITBUCKET_TAG
         #- rm -rf .git/
         #- python aws/msg_cleaner.py #get rid of messages from Fortran inside CMakeLists.txt
         #- rm -rf aws/
         #- git init 
         #- git add .
         #- git config --global user.email "$BITBUCKET_GIT_SSH_ORIGIN"
         #- git config --global user.name "$BITBUCKET_STEP_TRIGGERER_UUID"
         #- git commit -m "ginan initial"
         #- git tag  $BITBUCKET_TAG
         #- git remote add github_sync git@github.com:RodrigoNaves/ginan-bitbucket-update-tests.git
         #- git remote -v
         #- git config remote.origin.fetch "+refs/heads/*:refs/remotes/origin/*"
         #- git show-ref
         #- git push --force github_sync $BITBUCKET_TAG
         #- git remote rm github_sync
         - git branch master
         - git checkout -b $BITBUCKET_TAG
         - git pull origin $BITBUCKET_TAG
         #- git checkout tags/$BITBUCKET_TAG
         - python aws/msg_cleaner.py #get rid of messages from Fortran inside CMakeLists.txt
         - rm -rf aws/
         - rm README.md
         - rm bitbucket-pipelines.yml
         - git add .
         - git commit -m "$BITBUCKET_TAG"
         #- git checkout master
         #- git merge --squash $BITBUCKET_TAG
         #- git branch -D $BITBUCKET_TAG
         - git tag -d $BITBUCKET_TAG
         - git tag $BITBUCKET_TAG
         #- git tag  $BITBUCKET_TAG
         - git remote add github_sync git@github.com:RodrigoNaves/ginan-bitbucket-update-tests.git
         - git remote -v
         - git config remote.origin.fetch "+refs/heads/*:refs/remotes/origin/*"
         - git show-ref
         - git push --force github_sync $BITBUCKET_TAG
         - git remote rm github_sync